<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="main.css">
    <title>chrome automatic update blocker</title>
    <script defer>
      function gen() {
        try {
          var networks = document.querySelector("input").value;
          networks = networks.replace(/(?<=[+-]..){/g, "");
          networks = networks.replace(/(?<=})[^{\]}]*(?={.."C)/g, ",");
          networks = networks.substring(networks.indexOf("{"));
          networks = networks.substring(0, networks.lastIndexOf("}") + 1);
          networks = JSON.parse("[" + networks + "]");
          var onc = {
            Type: "UnencryptedConfiguration",
            NetworkConfigurations: [],
          };
          networks.forEach(function (network) {
            if (!network.WiFi || !network.Connectable) return;
            onc.NetworkConfigurations.push({
              GUID: network.GUID,
              Metered: true,
              Name: network.Name,
              Type: "WiFi",
              WiFi: {
                AutoConnect: true,
                SSID: network.Name,
                Security: "None",
              },
            });
          });
          if (!onc.NetworkConfigurations[0]) return;
          var link = document.createElement("a");
          link.href = URL.createObjectURL(new Blob([JSON.stringify(onc)]));
          link.download = "caub.onc";
          link.click();
          link.remove();
        } catch (error) {
          console.error(error);
          alert("caub ran into an error, check console logs");
        }
      }
    </script>
  </head>
  <body>
    <h1>CAUB (Chrome automatic update blocker)</h1>
    <h2>Brought to you by Dragontrror.</h2>
    <hr>
    <p><b>To start:</b></p>
    <p>Go to chrome://network#state - scroll to the bottom of the page</p>
    <p>You should see a list of "favorite" wifis that you've connected to in the past - click the + sign next to the wifi name of each network that you commonly connect your chromebook to</p>
    <p>Copy your wifi's whole thing for the wifi you wish to use CAUB on</p> 
    <p>Paste the copied text into the textbox below - press the "generate onc" button below the textbox</p>

    <hr/>
    <div class="center">
      <input placeholder="read instructions!" />
      <button onclick="gen()"><b>generate and download onc file</b></button>
    </div>
    <hr />

    <p>Once you have downloaded the file, go to chrome://network#general, then click
    on the "import onc" button and import the newly downloaded file</p>
    <p>Your chromebook will no longer automatically update (as long as you are
      on a wifi that you used caub on) be careful not to stay on a wifi for too
      long without using caub on it</p>
    <hr />
  </body>
</html>
